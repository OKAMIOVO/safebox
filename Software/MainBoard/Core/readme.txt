唤醒源 外部中断编号 
KEY_SET 0//不需要，模式键和设置键都在柜子内部，不开门时不能按，开门以后，门未关不能休眠，要一直报警

vibration 1//这个不只是休眠时打开，按完*打开震动报警以后都要打开
touch_board 0
alternate_sys 3//预留

0x80，激活成功



0x2x 激活注册相关
数据：
0，开始激活，触摸板收到后，如有需要，清空指纹头指纹数据，然后在有任意手指按压指纹头后上报激活成功
1，已激活，但未注册，指纹头暂时休息
2，注册密码，指纹头暂时休息
3。注册指纹，指纹头开始注册，重复5次，成功或失败后上报//有问题，需要播报再次放置手指，违背主板发送语音信息原则
4.注册完成，指纹头开始验证模式，

把主系统当成一体，所有外设 

主板 后板
1备用板通信
2led
3振动检测
4蜂鸣器
5电机
6机械按键（设置，模式）
7电池电压检测

触摸板  前板
1语音芯片
2LOGO LED1，2，3
3触摸按键（0~9，*，#）
4指纹头
5LED


未注册过时
上电处于未激活状态，此时任意手指按压指纹头，验证通过，变为激活未注册状态 无需定义激活未注册状态

没必要，反正指纹头能开锁就可以，类似指纹锁未注册任何用户状态

按下设置键，开始注册密码，密码注册完以后注册指纹

未注册时 按设置键 进入注册
注册过以后 长按模式键 切换模式
按* 打开震动报警
长按设置键3s 恢复出厂

错误报警
连续5次指纹错误
或3次密码错误
可通过正确的指纹或密码解除
低电量警报



首先作为一个整体，不分触摸板，指纹头，电机板 灯等模块，分析需求

上电读取密码和指纹列表
若未注册任何指纹和密码，则任何手指按压都开锁
检测到设置键按下后开始注册

开始注册后，
在有指纹头按压前有按键时，关闭指纹头灯，意为注册密码
在有按键前按压指纹头时，关闭按键led灯，意为注册指纹

未注册密码时，备用系统不能开锁

状态划分：初始化状态，空闲状态，注册状态，报警状态，休眠状态 5个状态已经完备

状态迁移表  可转换的状态
初始化      空闲            状态迁移事件 读取用户列表完成
空闲        注册            按下模式键，这里定义启动注册命令，是否有迁移条件，未注册过用户？
            警报            震动，连续验证失败 
注册        空闲            退出注册，注册超时
警报        空闲            60s,正确的验证信息
休眠

状态迁移验证完毕
接下来验证不改变系统状态的事件










初始化状态：读取用户注册列表，不响应除读取完用户列表完成之外的任何事件

空闲状态： 门关闭状态
可以进行指纹或密码验证
可以按*号打开震动报警
可以长按设置键恢复出厂设置
可以长按模式键切换 便携/安全模式
震动报警

报警状态，可以输入正确的指纹或密码解除

注册状态：分为3个子状态
等待注册
指纹注册
密码注册

各个状态的按键事件响应函数

门打开状态



        

